# ğŸ“˜ Lecture 08 â€“ Data Sanitization & Validation

---

## ğŸ§  Overview
Is lecture mein hum:
- Database ko **dirty data** se kaise bachate hain  
- Mongoose schema ke through **strict validations** lagate hain  
- API level aur Database level validations ka difference samajhte hain  
- User ko kya update karne dena chahiye aur kya nahi â€” ye control karna seekhte hain  

---

## â“ Why Data Validation is Important

User jo bhi data bhejta hai:
- Wo galat ho sakta hai  
- Wo malicious ho sakta hai  
- Database ko corrupt kar sakta hai  

Isliye:
> **Never trust `req.body`**

Validation aur sanitization ka kaam:
- Data clean rakhna  
- Database ko polluted hone se bachana  
- App ko secure banana  

---

## ğŸ§© Using Mongoose Schema for Validation

Mongoose ke schema mein hum strict rules define kar sakte hain.  
Ye rules MongoDB mein data jaane se pehle check hote hain.

Mongoose ki **official documentation** mein:
- Different validation rules
- Schema options  
available hote hain.

---

## âš™ï¸ Important Schema Options

### `required`
Field mandatory hota hai. Agar value nahi di â†’ error.

### `default`
Agar user value nahi deta â†’ ye value automatically set hoti hai.

### `select`
Field query results mein visible hona chahiye ya nahi â€” ye decide karta hai.

### `validate`
Custom validation function lagane ke liye use hota hai.

### `get`
Database se data nikalte waqt value ko modify karta hai.

### `set`
Database mein save hone se pehle value ko modify karta hai.

### `alias`
Ek field ke liye alternate name define karta hai.

### `immutable`
Ek baar set hone ke baad field ko change hone se rokta hai.

### `transform`
Document ko JSON banate waqt modify karta hai.

---

## ğŸ”‘ `unique: true` in Email

Email ko unique banane ka matlab:
- Same email se multiple users create nahi honge  
- Duplicate users database mein nahi jayenge  
- Login system reliable banega  

---

## ğŸ§ª Default Validation in Mongoose

Mongoose automatically apply karta hai:
- Type validation  
- Required check  
- Length check  

Isko hi **default validation** bolte hain.  
Iske alawa hum custom `validate` function bhi laga sakte hain.

---

## ğŸƒâ€â™‚ï¸ What is `runValidators`?

Normally:
- Update APIs validation skip kar deti hain  

Agar hum `runValidators: true` lagate hain:
- Update ke time bhi schema validation chalega  
- Galat data database mein save nahi hoga  

> Ye production apps ke liye bahut important hai.

---

## ğŸ”’ Preventing Email Update

Email ek **identity field** hota hai.  
Generally ek baar set hone ke baad:
- User ko email change nahi karne dena chahiye  

Iske liye:
- API level par check lagate hain  
- Agar update request mein email aaye â†’ reject kar dete hain  

---

## ğŸš« Restricting Fields in PATCH API

User ko sab kuch update karne dena dangerous hota hai.

Example:
- User apni age, bio, photo update kar sakta hai  
- User apni email, role, userId update nahi kar sakta  

Isliye:
- Allowed fields ki list banate hain  
- Sirf unhi fields ko update hone dete hain  

---

## ğŸ†š API Level vs Database Level Validation

### Database Level Validation
- Mongoose schema mein defined hoti hai  
- Har insert / update par automatically lagti hai  
- Bypass karna mushkil hota hai  

### API Level Validation
- Request aate hi check hoti hai  
- User ko clear error milta hai  
- Extra security layer provide karti hai  

> **Best practice: API + DB dono use karo**

---

## ğŸ“š Using External Validator Library

Mongoose basic validation deta hai.  
Advanced validation ke liye hum **validator** library use karte hain.

Validator se hum:
- Email validate kar sakte hain  
- Password strength check kar sakte hain  
- URL, phone, credit card validate kar sakte hain  

Isse database clean aur secure rehta hai.

---

## ğŸ”„ Update Methods in Mongoose

Update APIs ke liye:
- `findByIdAndUpdate`
- `findOneAndUpdate`  
use kiya jata hai.

Ye internally MongoDB ke update operations call karte hain.

---

## ğŸ†š findByIdAndUpdate vs findOneAndUpdate

### `findByIdAndUpdate`
- `_id` ke basis par update karta hai  
- Fast aur precise hota hai  
- Jab userId available ho â€” best choice  

### `findOneAndUpdate`
- Condition ke basis par update karta hai (email, username, etc.)  
- Jab id available na ho tab use hota hai  

---

## ğŸ§¹ Data Sanitization

Data sanitization ka matlab:
- Extra spaces remove karna  
- Lowercase / uppercase normalize karna  
- Special characters clean karna  
- Dangerous input remove karna  

Ye har field ke liye kiya jana chahiye (email, name, bio, etc.)

---

## ğŸ›¡ï¸ API Level Validation (Examples)

API par check karo:
- Email valid hai ya nahi  
- Skills array ka size limit  
- Password strength  
- Extra fields to nahi aa rahe  
- `req.params` valid hai ya nahi  

---

## âš™ï¸ Understanding Update Options (High Level)

Update ke saath hum control kar sakte hain:
- Old ya new document return ho  
- Validation chale ya nahi  
- Defaults apply ho  
- Timestamps update ho  
- Multiple match mein kaunsa doc update ho  
- Aliases ka behavior  

Ye options APIs ko:
- Zyada powerful  
- Zyada safe  
- Zyada predictable  
banate hain.

---

## âœ… Key Takeaways

- Validation database ko dirty data se bachata hai  
- Mongoose schema ek strong validation tool hai  
- `unique`, `required`, `default`, `validate` bahut important hote hain  
- `runValidators` update APIs ke liye must hai  
- API + DB validation dono use karna chahiye  
- External validator se advanced security milti hai  
- Update APIs mein strict control zaroori hai  

---
