## ğŸ“˜ Lecture 5 â€“ Middleware & Multiple Route Handlers

---

## ğŸ”¹ What if in a route handler, instead of sending response we do `console.log()`?

- Agar route handler ke andar sirf `console.log()` likha
- Aur **response (`res.send / res.end`) nahi bheja**
- Toh request **hang ho jaati hai**
- Browser / Postman ko kabhi response nahi milta

ğŸ‘‰ Har request ke liye **response bhejna mandatory** hota hai  
Ya phir request ko **next middleware** tak pass karna hota hai

---




## ğŸ”¹ One Route can have Multiple Route Handlers

Express me:
- Ek hi route ke liye **multiple handlers** ho sakte hain
- Ye handlers **sequence me execute** hote hain

Example (conceptually):
- First handler â†’ validation
- Second handler â†’ authentication
- Third handler â†’ final response

---



## ğŸ”¹ `res.send()` is like `return`

- `res.send()` ka matlab:
  - Response bhej diya
  - Request lifecycle **yahin end**
- Uske baad ka code **execute nahi hota**

Example concept:
- Agar pehle handler me `res.send()` ho gaya
- Toh doosra handler **kabhi chalega hi nahi**

ğŸ‘‰ Isliye `res.send()` ko carefully use karna hota hai

---




## ğŸ”¹ Agar hume chahiye ki pehla handler response na bheje  
## aur request next handler me chali jaye

ğŸ‘‰ Tab hum **`next()`** use karte hain

---

## ğŸ”¹ `next()` kya karta hai?

- `next()` request ko:
  - Current handler se
  - Next handler / middleware me bhej deta hai

Flow:




---

## ğŸ”¹ Galat Tarika (âŒ DO NOT DO THIS)

#
```js
(req, res, next) => {
    console.log("Handler 1");

    next({
        () => {
            console.log("Handler 2");
        }
    });
}
```



# âŒ Ye galat hai kyunki:

next() sirf control pass karta hai
Uske andar function ya object pass karna
Call stack error create karta hai



# ğŸ‘‰ Error type:

Call stack overflow
Unexpected behavior

ğŸ”¹ Sahi Tarika (âœ… Correct Way)


```js
(req, res, next) => {
    console.log("Handler 1");
    next();          // Control next handler ko de diya
}

```

Aur next handler:
```js
(req, res) => {
    res.send("Final Response");
}
```


ğŸ‘‰ Ye perfectly kaam karega

#ğŸ”¹ Important Rule (VERY IMPORTANT)
â— Ek request ke liye:

Ya toh res.send() / res.end() karo
Ya phir next() call karo
âŒ Dono ek saath mat karo




## ğŸ”¹ Common Error Scenario (Middleware)

- Agar **last middleware me bhi `next()` call ho gaya**
- Aur uske baad **koi route handler exist nahi karta**
- Toh Express **next matching route dhundhta hai**
- Aur error aata hai:
  Cannot GET /user


ğŸ‘‰ **Isliye important rule:**
- Last handler me **kabhi `next()` nahi likhte**
- Last handler **hamesha response bhejta hai**

---




## ğŸ”¹ Multiple Route Handlers using Array

- Express me hum **multiple route handlers ko ek array me wrap** kar sakte hain
- Ye handlers **ek ke baad ek (sequentially)** execute hote hain

**Concept:**  
`[handler1, handler2, handler3]`

ğŸ‘‰ Ye approach clean aur readable hoti hai

---




## ğŸ”¹ Mixed Style of Route Handlers (Allowed)

- Kuch route handlers **array ke andar** ho sakte hain
- Aur **final handler bahar** likha ja sakta hai
- Ye approach bhi **perfectly kaam karti hai**

**Concept:**  
`[handler1, handler2], handler3`

ğŸ‘‰ Express internally sab handlers ko **ek single execution flow** me treat karta hai

---




## ğŸ”¹ Real-World Use Case of Middleware Chaining

- Handler 1 â†’ Logging (request info print karna)
- Handler 2 â†’ Authentication (user valid hai ya nahi)
- Handler 3 â†’ Authorization (user ko access allowed hai ya nahi)
- Handler 4 â†’ Final Response (data bhejna)

ğŸ‘‰ Isliye **middleware chaining** Express ka **bahut powerful feature** hai

---



---

## ğŸ”¹ Route Handlers

- **Route handler** wo actual function hota hai jo **response send karta hai**
- Jo function `res.send()` / `res.json()` / `res.end()` call karta hai  
  ğŸ‘‰ wahi **route handler** hota hai

- Baaki jo functions:
  - response nahi bhejte
  - sirf logic execute karte hain  
  ğŸ‘‰ unko **middleware** kaha jata hai

ğŸ‘‰ Ye sirf terminology hai, internally Express:
- Request aane par
- Sab matching functions ko **sequence me execute karta hai**
- Jo function response nahi bhejta, use middleware treat karta hai

---




## ğŸ”¹ Middleware (Simple Definition)

- Middleware ek aisa function hota hai
- Jo **request aur response ke beech ka kaam karta hai**

Example kaam:
- Logging
- Authentication
- Validation
- Authorization

ğŸ‘‰ Middleware usually `next()` call karta hai taaki request aage badhe

---





## ğŸ”¹ Admin Concept (Why Middleware is Needed)

- Agar hum **admin ke liye routes** bana rahe hain
- Toh un routes se pehle hume:
  - check karna padega user admin hai ya nahi

Problem:
- Agar hum har admin route me same logic likhenge  
  â†’ code repeat hoga

Solution:
- Admin verification ka logic **middleware me likhte hain**
- Aur use har admin route ke pehle laga dete hain

ğŸ‘‰ Agar user admin nahi hai  
â†’ request **route tak pahunchti hi nahi**

---




## ğŸ”¹ Status Codes

### Common HTTP Status Codes

- **200** â†’ Request successful  
- **201** â†’ Resource created successfully  
- **400** â†’ Bad request (client ne galat data bheja)  
- **401** â†’ Unauthorized (user logged in nahi hai)  
- **403** â†’ Forbidden (user hai, par permission nahi hai)  
- **404** â†’ Route / resource not found  
- **500** â†’ Internal server error  

ğŸ‘‰ Status codes frontend ko batate hain  
request ka result kya raha

---




## ğŸ”¹ Admin Routes me `app.use()`

- Admin ke routes generally:
  - GET
  - POST  
  dono handle karte hain

Isliye:
- Admin ke liye routes aksar `app.use()` se likhe jaate hain
- Taaki **saare methods** handle ho jaayein

ğŸ‘‰ Example use-case:
- `/admin/*` ke liye middleware lagana

---




## ğŸ”¹ Difference between `app.use()` and `app.all()`

### `app.use()`
- Har HTTP method ke liye kaam karta hai
- Middleware aur routes dono ke liye use hota hai
- Mostly middleware ke liye use karte hain

### `app.all()`
- Sirf routes ke liye use hota hai
- Ek specific path ke liye **saare methods** handle karta hai

ğŸ‘‰ Real projects me `app.use()` zyada common hai

---



## ğŸ”¹ Error Handling

- Database ya external service ke saath kaam karte waqt
- Error aana common hai

Problem:
- Agar hum direct `throw new Error()` kar dein
- Aur handle na karein  
â†’ server crash ho sakta hai

Solution:
- DB logic ko **tryâ€“catch** block ke andar likhte hain
- Error ko:
  - catch karte hain
  - proper response bhejte hain

ğŸ‘‰ Express me proper error handling **bahut important** hai

---





## ğŸ”¹ Third-Party Middleware Examples

- `express.json()` â†’ JSON parse karne ke liye  
- `cors` â†’ Cross-origin requests allow karne ke liye  
- `morgan` â†’ Logging ke liye  
- `helmet` â†’ Security ke liye  

ğŸ‘‰ Ye sab ready-made middleware hote hain

---




## ğŸ”¹ Summary (Lecture 5)

- Route handler actual response bhejta hai
- Middleware requestâ€“response ke beech kaam karta hai
- Middleware se code reuse hota hai
- Admin verification middleware se hota hai
- Status codes response ka meaning batate hain
- `app.use()` admin routes ke liye common hai
- Errors ko tryâ€“catch me handle karna chahiye

---
